<include file="Public:header"/>
<link rel="stylesheet" href="__PUBLIC__/kindeditor-4.1.7/themes/default/default.css" />
<script src="__PUBLIC__/kindeditor-4.1.7/kindeditor.js"></script>
<script src="__PUBLIC__/kindeditor-4.1.7/lang/zh_CN.js"></script>
<script src="__PUBLIC__/date/WdatePicker.js"></script>
    <script>
      KindEditor.ready(function(K) {
        var editor = K.create('textarea[name="content"]', {
          allowFileManager : true,
          urlType:'domain',
          afterBlur : function(){  
                    //编辑器失去焦点时直接同步，可以取到值  
                    this.sync();  
                }  
        });
        K('#upload').click(function() {
          editor.loadPlugin('image', function() {
            editor.plugin.imageDialog({
              showRemote : false,
              imageUrl : K('#headpic').val(),
              clickFn : function(url, title, width, height, border, align) {
                var url = "{jasxun:C('SITE_URL')}"+url;
                K('#headpic').val(url);
                K('#pic').attr('src',url);
                editor.hideDialog();
              }
            });
          });
        });
      });
    </script>
    <script src="__PUBLIC__/uploadify/jquery.uploadify.min.js" type="text/javascript"></script>
      <script type="text/javascript">
      $(function(){
        $(".cancel").die().live("click",function(){
            $(this).parent(".House").remove();
          });
      });
      </script>
    <style type="text/css">
    .House{
      float: left;
      width: 140px;
      height: 100px;
      margin: 8px;
    }
    .House img{
      float: left;
      width: 100px;
      height: 60px;
      border:1px; 
      background: #fff;
      border:1px solid #666;
      padding: 6px;
    }
    .House a{
      display: block;
      width: 100px;
      display: 30px;
      line-height: 30px;
      text-align: center;
    }
    .file_upload{
      margin-top:10px;
      clear: both;
    }
    </style>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/uploadify/uploadify.css">
<!-- main -->
<div class="main span10">
    <h4>编辑<a href="{jasxun:U(GROUP_NAME.'/Schedule/index')}" class="pull-right" ><i class="icon-backward"></i> <strong>返回列表</strong></a></h4>
<hr>
    <form action="{jasxun:U(GROUP_NAME.'/Schedule/update')}" method="post" accept-charset="utf-8" class="well form-inline" id="f" onSubmit="return qjy_ajaxform(this,function(d){opt_ok_return(d)})"> 
      <table class="table table-bordered table-wordpress postlist-table">
        <tbody>
        
<tr>
          <td width="25%"><label for="title">标题<font color="red">*</font></label></td>
          <td><input type="text" name="title" value="{jasxun:$vo['title']}" id="title" class="span8"/></td>
        </tr>  
         <tr>
          <td><label for="title">缩略图  <font color="red">*</font></label></td>
          <td>
              <img src="{jasxun:$vo['thumb']}" id="pic" style="height:60px;width:60px;"><br/>
            <input type="text" name="thumb" value="{jasxun:$vo['thumb']}" id="thumb" class="span4"  />
            <input type="button" value="选择图片" id="upload" class="btn btn-primary"></td>
        </tr>  
        <tr>
          <td><label for="title">剧情简介 <font color="red">*</font></label></td>
          <td><textarea name="content" class="span8" style="height:380px;">{jasxun:$vo['content']}</textarea>
          </td>
        </tr> 
        <tr>
          <td width="25%"><label for="title">演出时间<font color="red">*</font></label></td>
          <td><input type="text" name="playtime" value="{jasxun:$vo['playtime']}" id="playtime" class="span8"/></td>
        </tr>  
        <tr>
          <td width="25%"><label for="address">演出地点<font color="red">*</font></label></td>
          <td><input type="text" name="address" value="{jasxun:$vo['address']}" id="address" class="span8"/></td>
        </tr>  
         <tr><td>
          <label for="discription">入场规定</label></td>
          <td><textarea name="rule" id="rule" class="input-autosave span8" >{jasxun:$vo['rule']}</textarea>                </td>
        </tr> 
         <tr><td>
          <label for="discription">订票说明</label></td>
          <td><textarea name="remark" id="remark" class="input-autosave span8" >{jasxun:$vo['remark']}</textarea>                </td>
        </tr> 
        <tr>
          <td width="25%"><label for="title">总票数<font color="red">*</font></label></td>
          <td><input type="text" name="num" value="{jasxun:$vo['num']}" id="num" class="span4"/></td>
        </tr>  
        <tr>
          <td width="25%"><label for="title">具体票价<font color="red">*</font></label></td>
          <td>
             排数：
             <input type="text" name="price_content[0][title]" value="1-5"  class="span2"/>
             价格：
             <input type="text" name="price_content[0][price]" value="168"  class="span2"/>
             票数：
             <input type="text" name="price_content[0][num]" value="100"  class="span2"/>
             <input type="hidden" name="price_content[0][type]" value="1">
             <br/>
             排数：
             <input type="text" name="price_content[1][title]" value="6-10"  class="span2"/>
             价格：
             <input type="text" name="price_content[1][price]" value="388"  class="span2"/>
               票数：
             <input type="text" name="price_content[1][num]" value="100"  class="span2"/>
             <input type="hidden" name="price_content[1][type]" value="2">
             <br/>
             排数：
             <input type="text" name="price_content[2][title]" value="11-20"  class="span2"/>
             价格：
             <input type="text" name="price_content[2][price]" value="288"  class="span2"/>
             票数：
             <input type="text" name="price_content[2][num]" value="100"  class="span2"/>
             <input type="hidden" name="price_content[2][type]" value="3">

          </td>
        </tr>  
        <tr>
          <td><label for="rate">预定时间<font color="red">*</font></label></td>
          <td>开始于<input type="text" onfocus="WdatePicker({dateFmt:'yyyy-M-d H:mm:ss'})" name="start_time" value="{jasxun$vo['start_time']|date='Y-m-d H:i:s',###}" id="start_time" class="span4"/>至
            <input type="text" name="end_time" onfocus="WdatePicker({dateFmt:'yyyy-M-d H:mm:ss',minDate:'#F{$dp.$D(\'start_time\')}'})" value="{jasxun$vo['end_time']|date='Y-m-d H:i:s',###}" id="end_time" class="span4"/>结束</td>
        </tr>  
        <tr>
          <td width="25%"><label for="title">演出时长<font color="red">*</font></label></td>
          <td><input type="text" name="length" value="{jasxun:$vo['length']}" id="length" class="span4"/></td>
        </tr>  
            <php>$adv = explode(',',$vo['adv']);</php>
            <tr><td>
            <label for="title">幻灯片</label></td>
            <td><div id="xmzb">
             <php>if(!empty($vo['adv'])){</php>
              <foreach name="adv" item="list">
              <div class='House'>
                <img class='uploadifyimg' src='{jasxun:$list}' style='margin-left:15px;margin-top:15px'/>
                <input type='hidden' name='adv[]'  value='{jasxun:$list}'><a class='cancel' href='javascript:void(0);'>删除</a>
              </div>
              </foreach>
              <php>}</php>
            </div>
        </td>
          </tr>
          <tr><td></td>
                     <td><input id="xmzb_upload" name="xmzb_upload" class="file_upload" type="file" multiple="true"></td>
             <td>
             </tr> 
         <tr>
         <td><label for="title">状态<font color="red">*</font></label></td>
           <td>
           <input name="type" <if condition="$vo['status'] eq 0">checked="checked"</if> value="0" type="radio">正常
           <input name="type" <if condition="$vo['status'] eq 1">checked="checked"</if> value="1" type="radio">结束
         </td>
         </tr>     
        <tr><td></td>
        <td><input name="id" value="{jasxun:$vo['id']}" type="hidden">
          <input type="submit" value="保存" id="submit" class="btn btn-large btn-success"  /></td>
       </tr>
        </tbody>
    </table>
        
    </form>
</div>
<script type="text/javascript">
  <?php $timestamp = time();?>
  $(function() {
    $('#xmzb_upload').uploadify({
      'formData'     : {
        '<?php echo session_name();?>' : '<?php echo session_id();?>', //此处获取SESSIONID
        'timestamp' : '<?php echo $timestamp;?>',
        'token'     : '<?php echo md5('unique_salt' . $timestamp);?>'
      },
      'swf'      : '__PUBLIC__/uploadify/uploadify.swf',
      'buttonText':'选择图片',
      'uploader' : '__PUBLIC__/uploadify/uploadify.php',
      'onUploadSuccess' : function(file, data, response) {
        var jsonObject = jQuery.parseJSON(data);
        var str=$('#xmzb').html();
          var add="<div class='House'><img class='uploadifyimg' src='"+jsonObject.msg+"' style='margin-left:15px;margin-top:15px'/><input type='hidden' name='adv[]'  value='"+jsonObject.msg+"'><a class='cancel' href='javascript:void(0);'>删除</a></div>";
          str+=add;
       $('#xmzb').html(str);
      },
    });
  });
</script>
<!-- main -->
<include file="Public:footer"/>